<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Burga al Corte</title>
  <meta name="description" content="Las mejores hamburguesas artesanales de Dique Luj√°n. Ped√≠ online y recib√≠ en tu casa.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçî</text></svg>">
  <link rel="stylesheet" href="style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <header>
    <div class="header-brand">
      <img src="LOGO BURGA AL CORTE.jpg" alt="Logo" class="logo">
      <h1>BURGA AL CORTE</h1>
    </div>
    <nav>
      <a href="#menu">üçî Men√∫</a>
      <a href="#promos">üéØ Promos</a>
      <a href="#bebidas">ü•§ Bebidas</a>
      <a href="#extra">üçü Extras</a>
      <a href="#redes">üì± Contacto</a>
    </nav>
  </header>


  </div>



  <!-- Navegaci√≥n lateral flotante -->
  <div class="nav-lateral">
    <!-- Bot√≥n del carrito en la navegaci√≥n lateral -->
    <button class="nav-btn-lateral carrito-btn-lateral" onclick="abrirCarrito()">
      <div class="nav-icon">
        <svg viewBox="0 0 576 512" fill="currentColor" width="24" height="24">
          <path d="M0 24C0 10.7 10.7 0 24 0H69.5c22.2 0 41.5 15.8 45.6 37.5l7.9 41.5H488c22.6 0 37.9 21.4 32.5 42.9l-96 384c-2.9 11.4-12.9 19.1-24.5 19.1H152c-11.6 0-21.6-7.7-24.5-19.1L51.5 85.5l-7.9-41.5C41.5 21.8 22.2 6 0 24zM176 512a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm256-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0z"/>
        </svg>
        <div class="carrito-contador-lateral" id="carrito-contador-lateral">0</div>
      </div>
      <span class="nav-text">Carrito</span>
    </button>
    
    <!-- Separador visual -->
    <div class="nav-separador"></div>
    
    <button class="nav-btn-lateral" onclick="scrollToSection('menu')" data-section="menu">
      <span class="nav-icon">üçî</span>
      <span class="nav-text">Men√∫</span>
    </button>
    <button class="nav-btn-lateral" onclick="scrollToSection('promos')" data-section="promos">
      <span class="nav-icon">üéØ</span>
      <span class="nav-text">Promos</span>
    </button>
    <button class="nav-btn-lateral" onclick="scrollToSection('bebidas')" data-section="bebidas">
      <span class="nav-icon">ü•§</span>
      <span class="nav-text">Bebidas</span>
    </button>
    <button class="nav-btn-lateral" onclick="scrollToSection('extra')" data-section="extra">
      <span class="nav-icon">üçü</span>
      <span class="nav-text">Extras</span>
    </button>
    <button class="nav-btn-lateral" onclick="scrollToSection('redes')" data-section="redes">
      <span class="nav-icon">üì±</span>
      <span class="nav-text">Contacto</span>
    </button>
  </div>

  <!-- Panel lateral (oculto) -->
  <div class="sidebar">
    <nav>
      <a href="#menu">üçî Men√∫</a>
      <a href="#promos">üéØ Promo</a>
      <a href="#bebidas">ü•§ Bebida</a>
      <a href="#extra">üçü Extras</a>
      <a href="#redes">üì± Contacto</a>
    </nav>
  </div>

  <!-- Contenido principal -->
  <div class="content-area">
    <main>
    <section id="menu">
      <h2>Hamburguesas</h2>
      <div class="hamburguesas-container">
        <!-- Primeras 8 hamburguesas en layout especial -->
        <div class="hamburguesas-featured" id="hamburguesas-featured">
        </div>
        
        <!-- Resto de hamburguesas en grid normal -->
        <div class="grid" id="hamburguesas-grid" style="display: none;">
        </div>
      </div>
    </section>

    <section id="promos">
      <h2>Promociones</h2>
      <div class="grid" id="promos-grid">
      </div>
    </section>


    <section id="bebidas">
      <h2>Bebidas</h2>
      <div class="grid" id="bebidas-grid"></div>
    </section>

    <section id="extra">
      <h2>Extras</h2>
      <div class="grid" id="extra-grid"></div>
    </section>

    <section id="contacto">
      <h2>üì± Contacto</h2>
      <div class="contacto-info">
        <div class="contacto-item">
          <i class="fas fa-map-marker-alt"></i>
          <div>
            <h3>Ubicaci√≥n</h3>
            <a href="https://maps.app.goo.gl/8Qw6Qw2Qw2Qw2Qw2A" target="_blank" style="color:inherit;text-decoration:underline;">Santa Fe 613 y 12 de Octubre, Dique Luj√°n</a>
          </div>
        </div>
        <div class="contacto-item">
          <i class="fab fa-whatsapp"></i>
          <div>
            <h3>WhatsApp</h3>
            <a href="https://api.whatsapp.com/send?phone=541141690977" target="_blank" style="color:inherit;text-decoration:underline;">Hac√© tu pedido directamente</a>
          </div>
        </div>
        <div class="contacto-item">
          <i class="fas fa-clock"></i>
          <div>
            <h3>Horarios</h3>
            <p>
              Jueves de 19:30 hs a 00:00 hs<br>
              Viernes de 19:30 hs a 00:00 hs<br>
              S√°bado de 19:30 hs a 00:00 hs<br>
              Domingo de 19:30 hs a 00:00 hs
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal Selector de Bebidas para Promos -->
    <div id="modal-bebidas-promo" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center;">
      <div style="background:white; border-radius:15px; padding:30px; max-width:500px; width:90%; max-height:80%; overflow-y:auto;">
        <h3 id="modal-bebidas-titulo" style="text-align:center; margin-bottom:20px; color:#2c3e50;">ü•§ Eleg√≠ tus 3 Bebidas Gratis</h3>
        <p id="modal-bebidas-descripcion" style="text-align:center; margin-bottom:25px; color:#666; font-size:14px;">
          Tu promo incluye 3 bebidas. Seleccion√° la cantidad de cada una:
        </p>
        
  <div id="selector-bebidas-content">
          <!-- Contenido din√°mico generado por JavaScript -->
        </div>
        
        <div style="display:flex; gap:10px; justify-content:space-between; margin-top:25px;">
          <button onclick="cancelarSeleccionBebidas()" style="flex:1; padding:12px; background:#e74c3c; color:white; border:none; border-radius:8px; cursor:pointer;">
            ‚ùå Cancelar
          </button>
          <button onclick="confirmarSeleccionBebidas()" style="flex:1; padding:12px; background:#27ae60; color:white; border:none; border-radius:8px; cursor:pointer;">
            ‚úÖ Confirmar
          </button>
        </div>
      </div>
    </div>

    <!-- Modal del Carrito de Compras -->
    <div id="modal-carrito" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; justify-content:center; align-items:center;">
      <div class="carrito-modal-content">
        <div class="carrito-header">
          <h2>üõí Tu Pedido</h2>
          <button class="btn-cerrar-carrito" onclick="cerrarCarrito()">‚úñÔ∏è</button>
        </div>
        
        <div class="carrito-body">
          <ul id="lista-carrito"></ul>
          <div class="carrito-total">
            <p id="total-carrito">Total: $0</p>
          </div>
          
          <div class="formulario-extra">
            <div class="form-group">
              <label for="pedido-nombre">Tu nombre:</label>
              <input type="text" id="pedido-nombre" placeholder="Ej: Franco Martinez" required>
            </div>

            <div class="form-group">
              <label for="pedido-direccion">Tu direcci√≥n:</label>
              <input type="text" id="pedido-direccion" placeholder="Ej: Santa Fe 613 y 12 de octubre" required>
            </div>

            <div class="form-group">
              <label for="pedido-telefono">Tu tel√©fono:</label>
              <input type="tel" id="pedido-telefono" placeholder="Ej: 3512345678" required>
            </div>
            
            <div class="metodos-pago">
              <h3>M√©todo de Pago:</h3>
              <div class="opciones-pago">
                <button type="button" class="btn-pago" id="btn-efectivo" onclick="seleccionarPago('efectivo')">
                  üíµ Efectivo
                </button>
                <!-- OCULTO TEMPORALMENTE - Descomentar cuando est√© configurado MercadoPago API
                <button type="button" class="btn-pago" id="btn-mercadopago" onclick="seleccionarPago('mercadopago')">
                  üí≥ MercadoPago
                </button>
                -->
              </div>
              <p class="descripcion-pago" id="desc-pago"></p>
            </div>
          </div>

          <button class="btn-pedido" onclick="realizarPedido()" id="btn-hacer-pedido" disabled>Hacer Pedido</button>
          
          <div id="resumen-mercadopago" style="display:none; margin-top:20px; background:#fffbe6; border:1px solid #ffe58f; border-radius:10px; padding:20px;">
            <h3>üí≥ Transferencia por Mercado Pago</h3>
            <p><b>Total a transferir:</b> <span id="mp-total" style="font-size:1.2em;color:#d48806"></span></p>
            <p><b>Alias:</b> <span id="mp-alias"></span> <button onclick="copiarMP('alias')">Copiar</button></p>
            <p><b>CBU:</b> <span id="mp-cbu"></span> <button onclick="copiarMP('cbu')">Copiar</button></p>
            <p><b>Nombre destinatario:</b> <span id="mp-titular"></span> <button onclick="copiarMP('titular')">Copiar</button></p>
            <p style="color:#ad6800">Realiz√° la transferencia y luego confirm√° tu pedido por WhatsApp.</p>
            <button onclick="cerrarResumenMP()" style="margin-top:10px;">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
  </main>
  </div>

  <footer id="redes">
    <p><i class="fas fa-map-marker-alt"></i> Santa Fe 613 y 12 de Octubre, Dique Luj√°n</p>
    <div class="redes">
      <a href="https://www.instagram.com/burga_alcorte?igsh=bWFvaHhsOXN2bmcx" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="https://api.whatsapp.com/send?phone=1141690977" target="_blank"><i class="fab fa-whatsapp"></i></a>
    </div>
  </footer>

  <script type="module">
    // --- FUNCIONES MERCADO PAGO RESUMEN ---
    window.mostrarResumenMercadoPago = function(total) {
      document.getElementById('mp-total').textContent = "$" + total.toLocaleString();
      document.getElementById('mp-alias').textContent = datosMercadoPago.alias;
      document.getElementById('mp-cbu').textContent = datosMercadoPago.cbu;
      document.getElementById('mp-titular').textContent = datosMercadoPago.titular;
      document.getElementById('resumen-mercadopago').style.display = 'block';
      window.scrollTo({top:0,behavior:'smooth'});
    }
    window.cerrarResumenMP = function() {
      document.getElementById('resumen-mercadopago').style.display = 'none';
    }
    window.copiarMP = function(tipo) {
      let texto = '';
      if(tipo==='alias') {
        texto = datosMercadoPago.alias;
        // Abrir Mercado Pago primero para evitar bloqueos
        window.open('https://www.mercadopago.com.ar/', '_blank');
        navigator.clipboard.writeText(texto).then(()=>{
          mostrarAvisoPegado('alias');
          alert('Copiado: ' + texto);
        });
        return;
      }
      if(tipo==='cbu') {
        texto = datosMercadoPago.cbu;
        navigator.clipboard.writeText(texto).then(()=>{
          mostrarAvisoPegado('cbu');
          alert('Copiado: ' + texto);
        });
        return;
      }
      if(tipo==='titular') {
        texto = datosMercadoPago.titular;
        navigator.clipboard.writeText(texto).then(()=>{
          alert('Copiado: ' + texto);
        });
        return;
      }

      // Funci√≥n para mostrar aviso visual
      function mostrarAvisoPegado(tipo) {
        let mensaje = '';
        if(tipo==='alias') mensaje = 'Alias copiado. Ahora pegalo (Ctrl+V) en Mercado Pago para transferir.';
        if(tipo==='cbu') mensaje = 'CBU copiado. Ahora pegalo (Ctrl+V) en Mercado Pago para transferir.';
        if(!document.getElementById('aviso-pegar')) {
          const aviso = document.createElement('div');
          aviso.id = 'aviso-pegar';
          aviso.textContent = mensaje;
          aviso.style.position = 'fixed';
          aviso.style.bottom = '30px';
          aviso.style.left = '50%';
          aviso.style.transform = 'translateX(-50%)';
          aviso.style.background = '#fffbe6';
          aviso.style.border = '1px solid #ffe58f';
          aviso.style.color = '#ad6800';
          aviso.style.padding = '12px 24px';
          aviso.style.borderRadius = '8px';
          aviso.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
          aviso.style.zIndex = '9999';
          document.body.appendChild(aviso);
          setTimeout(()=>{
            aviso.remove();
          }, 5000);
        }
      }
    }
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, setDoc, doc, runTransaction, getDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    // BASE DE DATOS PRINCIPAL
    const firebaseConfig = {
  apiKey: "AIzaSyCOkXZe6EEKKUR2Sua0WuViwRQtgfZn-c0",
  authDomain: "la-burga-al-corte.firebaseapp.com",
  databaseURL: "https://la-burga-al-corte-default-rtdb.firebaseio.com",
  projectId: "la-burga-al-corte",
  storageBucket: "la-burga-al-corte.firebasestorage.app",
  messagingSenderId: "297665758581",
  appId: "1:297665758581:web:f5db4ba8cbe590df503f3c",
  measurementId: "G-S06FL6RRLG"
    };

    // BASE DE DATOS DE RESPALDO (autom√°tica si falla la principal)
    const firebaseConfigRespaldo = {
  apiKey: "AIzaSyBT_wvHZwRwDIiVqCOt8TKdh9yYQJDI0nI",
  authDomain: "burga-al-cortee.firebaseapp.com",
  projectId: "burga-al-cortee",
  storageBucket: "burga-al-cortee.firebasestorage.app",
  messagingSenderId: "116762550328886072238",
  appId: "1:116762550328886072238:web:8c7f3f5b9e8d4a1c2b3d4e"
    };

    let db = null;
    let firebaseInicializado = false;
    let usandoRespaldo = false; // Indica si estamos usando la BD de respaldo
    
    // Inicializaci√≥n de Firebase BAJO DEMANDA con sistema de respaldo autom√°tico
    async function inicializarFirebase() {
      if (firebaseInicializado) return; // Evitar m√∫ltiples inicializaciones
      
      try {
        console.log("üîÑ Conectando a Firebase (base de datos principal)...");
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        window.db = db; // Exponer tambi√©n en scope global
        
        // Verificar que la base de datos funciona correctamente
        await verificarConexionFirebase();
        
        firebaseInicializado = true;
        usandoRespaldo = false;
        console.log("‚úÖ Firebase conectado correctamente (base de datos principal)");
        
        // Inicializar sistema de IDs √∫nicos si es necesario
        await inicializarSistemaIds();
        
        console.log("üéØ Firebase listo para usar bajo demanda");
        
        return true;
      } catch (error) {
        console.log("‚ö†Ô∏è Error conectando a base de datos principal:", error);
        console.log("üîÑ Intentando conectar a base de datos de respaldo...");
        
        // Intentar con base de datos de respaldo
        return await inicializarFirebaseRespaldo();
      }
    }
    
    // Funci√≥n para inicializar Firebase con la base de datos de respaldo
    async function inicializarFirebaseRespaldo() {
      try {
        console.log("üîÑ Conectando a Firebase (base de datos de respaldo)...");
        const appRespaldo = initializeApp(firebaseConfigRespaldo, 'respaldo');
        db = getFirestore(appRespaldo);
        window.db = db;
        
        // Verificar conexi√≥n
        await verificarConexionFirebase();
        
        firebaseInicializado = true;
        usandoRespaldo = true;
        console.log("‚úÖ Firebase conectado correctamente (base de datos de RESPALDO)");
        console.log("‚ÑπÔ∏è La p√°gina est√° funcionando con la base de datos de respaldo");
        
        // Inicializar sistema de IDs √∫nicos
        await inicializarSistemaIds();
        
        console.log("üéØ Firebase de respaldo listo para usar");
        
        return true;
      } catch (errorRespaldo) {
        console.log("‚ùå Error conectando a base de datos de respaldo:", errorRespaldo);
        firebaseInicializado = false;
        usandoRespaldo = false;
        return false;
      }
    }
    
    // Funci√≥n para verificar que la conexi√≥n a Firebase funciona
    async function verificarConexionFirebase() {
      if (!db) throw new Error('Base de datos no inicializada');
      
      try {
        // Intentar leer el contador de pedidos (operaci√≥n simple)
        const contadorRef = doc(db, 'sistema', 'contador_pedidos');
        await getDoc(contadorRef);
        console.log("‚úÖ Conexi√≥n a Firebase verificada correctamente");
      } catch (error) {
        console.log("‚ö†Ô∏è Error verificando conexi√≥n:", error);
        // Si es error de cuota, lo lanzamos para activar respaldo
        if (error.code === 'resource-exhausted' || error.message.includes('quota')) {
          throw new Error('Cuota de Firebase excedida');
        }
        throw error;
      }
    }
    
    // Exponer funci√≥n para uso bajo demanda
    window.inicializarFirebase = inicializarFirebase;
    window.db = null; // Exponer db para verificaciones
    
    // NO ejecutar inicializaci√≥n autom√°ticamente - solo bajo demanda
    
    // Funci√≥n para inicializar el sistema de IDs √∫nicos
    async function inicializarSistemaIds() {
      if (!db) return;
      
      try {
        const contadorRef = doc(db, 'sistema', 'contador_pedidos');
        const contadorDoc = await getDoc(contadorRef);
        
        if (!contadorDoc.exists()) {
          console.log('üîß Inicializando contador de pedidos...');
          await setDoc(contadorRef, { 
            ultimo_id: 0,
            creado: new Date(),
            descripcion: 'Contador global de IDs de pedidos para sincronizaci√≥n web-escritorio'
          });
          console.log('‚úÖ Contador inicializado correctamente');
        } else {
          console.log('‚úÖ Sistema de IDs ya inicializado');
        }
      } catch (error) {
        console.log('‚ö†Ô∏è Error inicializando sistema de IDs:', error);
      }
    }

    // Funci√≥n para obtener IDs √∫nicos globales con transacciones
    window.getNextPedidoId = async function() {
      if (!db) {
        console.error('‚ùå Firebase no est√° disponible');
        throw new Error('Firebase no disponible');
      }
      
      try {
        console.log('üîÑ Obteniendo pr√≥ximo ID √∫nico con transacci√≥n...');
        
        const contadorRef = doc(db, 'sistema', 'contador_pedidos');
        
        const nuevoId = await runTransaction(db, async (transaction) => {
          const contadorDoc = await transaction.get(contadorRef);
          
          if (!contadorDoc.exists()) {
            // Si no existe el documento, lo creamos con ID inicial
            console.log('üìù Creando contador inicial...');
            transaction.set(contadorRef, { ultimo_id: 1 });
            return 1;
          }
          
          const datosActuales = contadorDoc.data();
          const siguienteId = (datosActuales.ultimo_id || 0) + 1;
          
          // Incrementar el contador de forma at√≥mica
          transaction.update(contadorRef, { ultimo_id: siguienteId });
          
          console.log(`üî¢ ID √∫nico generado: ${siguienteId}`);
          return siguienteId;
        });
        
        return nuevoId;
      } catch (error) {
        console.error('‚ùå Error obteniendo ID √∫nico:', error);
        
        // Si es error de cuota y estamos en BD principal, cambiar a respaldo
        if (!usandoRespaldo && (error.code === 'resource-exhausted' || error.message.includes('quota'))) {
          console.log('‚ö†Ô∏è Cuota excedida, cambiando a base de datos de respaldo...');
          
          try {
            firebaseInicializado = false;
            db = null;
            window.db = null;
            
            const exitoRespaldo = await inicializarFirebaseRespaldo();
            
            if (exitoRespaldo && db) {
              console.log('‚úÖ Cambiado a respaldo, reintentando obtener ID...');
              return await window.getNextPedidoId();
            }
          } catch (errorRespaldo) {
            console.error('‚ùå Error cambiando a respaldo:', errorRespaldo);
          }
        }
        
        // Fallback: intentar con el m√©todo anterior como respaldo
        try {
          console.log('‚ö†Ô∏è Usando m√©todo de respaldo alternativo...');
          const snapshot = await getDocs(collection(db, 'pedidos'));
          let maxId = 0;
          
          snapshot.forEach(docSnap => {
            const docId = parseInt(docSnap.id);
            if (!isNaN(docId) && docId > maxId) {
              maxId = docId;
            }
          });
          
          return maxId + 1;
        } catch (fallbackError) {
          console.error('‚ùå Error en m√©todo de respaldo:', fallbackError);
          throw new Error('No se pudo obtener ID √∫nico');
        }
      }
    };

    window.guardarEnFirebase = async function(pedidoData) {
      console.log('üî• Funci√≥n guardarEnFirebase llamada');
      console.log('üìä Datos recibidos:', pedidoData);
      console.log('üîó Base de datos disponible:', !!db);
      
      if (!db) {
        console.log('‚ùå No hay conexi√≥n a Firebase');
        return null;
      }
      
      try {
        console.log('üìù Obteniendo ID √∫nico global...');
        const proximoId = await window.getNextPedidoId();
        console.log('üî¢ ID √∫nico asignado:', proximoId);
        
        // Obtener fecha y hora EXACTA del momento del pedido
        const ahoraExacto = new Date();
        
        // Estructura exacta del programa de escritorio
        // Aceptar tanto 'productos' como 'items' para compatibilidad
        const productosFuente = pedidoData.productos || pedidoData.items || [];

        const docData = {
          direccion: pedidoData.direccion,
          estado: "pendiente",
          fecha: ahoraExacto,
          fecha_pedido: ahoraExacto,
          id_pedido: proximoId.toString(),
          items: productosFuente.map((item, index) => {
            const prod = {
              cantidad: String(item.cantidad || item.cantidad === 0 ? item.cantidad : 1),
              nombre: item.nombre,
              precio: item.precio,
              producto_id: (item.producto_id || item.id || (index + 1)).toString()
            };
            // Incluir bebidas gratuitas si vienen en el pedido (agregado_gratis)
            if (item.agregado_gratis && Array.isArray(item.agregado_gratis) && item.agregado_gratis.length > 0) {
              prod.agregado_bebidas = item.agregado_gratis;
            } else if (item.agregado_gratis === undefined && item.bebidas) {
              // Backwards compatibility: if 'bebidas' objeto est√° presente, convertir a array
              const bebidasArr = [];
              Object.entries(item.bebidas || {}).forEach(([bebida, cantidad]) => {
                let nombreBebida = (bebida || '').trim().toLowerCase() === 'seven up' ? '7up' : bebida;
                for (let i = 0; i < cantidad; i++) bebidasArr.push(nombreBebida);
              });
              if (bebidasArr.length > 0) prod.agregado_bebidas = bebidasArr;
            }
            return prod;
          }),
          metodo_pago: pedidoData.metodoPago,
          nombre_cliente: pedidoData.nombre,
          origen: "web",
          telefono: pedidoData.telefono || '',
          total: pedidoData.total
        };
        
        console.log('üíæ Guardando documento:', docData);
        await setDoc(doc(db, 'pedidos', proximoId.toString()), docData);
        console.log('‚úÖ Documento guardado exitosamente');
        
        if (usandoRespaldo) {
          console.log('‚ÑπÔ∏è Pedido guardado en base de datos de RESPALDO');
        }
        
        return proximoId.toString();
      } catch (error) {
        console.error('‚ùå Error detallado guardando pedido:', error);
        
        // Si el error es de cuota excedida y estamos usando BD principal, cambiar a respaldo
        if (!usandoRespaldo && (error.code === 'resource-exhausted' || error.message.includes('quota'))) {
          console.log('‚ö†Ô∏è Cuota de base de datos principal excedida');
          console.log('üîÑ Cambiando autom√°ticamente a base de datos de respaldo...');
          
          try {
            // Reinicializar con base de datos de respaldo
            firebaseInicializado = false;
            db = null;
            window.db = null;
            
            const exitoRespaldo = await inicializarFirebaseRespaldo();
            
            if (exitoRespaldo && db) {
              console.log('‚úÖ Cambiado a base de datos de respaldo exitosamente');
              console.log('üîÑ Reintentando guardar pedido...');
              
              // Reintentar guardar el pedido con la BD de respaldo
              return await window.guardarEnFirebase(pedidoData);
            } else {
              throw new Error('No se pudo conectar a base de datos de respaldo');
            }
          } catch (errorRespaldo) {
            console.error('‚ùå Error cambiando a base de datos de respaldo:', errorRespaldo);
            throw new Error('Error guardando pedido: bases de datos no disponibles');
          }
        }
        
        throw error;
      }
    };

    // Funci√≥n para cargar productos desde Firebase
    window.cargarProductosDesdeFirebase = async function() {
      if (!db) {
        console.log('‚ö†Ô∏è Firebase no disponible, usando productos de respaldo');
        window.mostrarProductosRespaldo();
        return;
      }
      
      try {
        console.log('üì¶ Cargando productos desde Firebase...');
        const productosSnapshot = await getDocs(collection(db, 'productos'));
        const productos = [];
        
        productosSnapshot.forEach(doc => {
          const data = doc.data();
          productos.push({
            id: doc.id,
            nombre: data.nombre,
            precio: data.precio,
            categoria: data.categoria || 'hamburguesa',
            descripcion: data.descripcion || 'Deliciosa opci√≥n de nuestra carta',
            imagen: data.imagen || `./fotos/${data.categoria || 'hamburguesas'}/${data.nombre.toLowerCase()}.jpg`,
            disponible: data.disponible !== false
          });
        });
        
        if (productos.length > 0) {
          console.log(`‚úÖ ${productos.length} productos cargados desde Firebase`);
          if (usandoRespaldo) {
            console.log('‚ÑπÔ∏è Productos cargados desde base de datos de RESPALDO');
          }
          window.mostrarProductos(productos);
        } else {
          console.log('‚ö†Ô∏è No se encontraron productos en Firebase, usando respaldo');
          window.mostrarProductosRespaldo();
        }
      } catch (error) {
        console.error('‚ùå Error cargando productos desde Firebase:', error);
        
        // Si el error es de cuota y estamos en BD principal, cambiar a respaldo
        if (!usandoRespaldo && (error.code === 'resource-exhausted' || error.message.includes('quota'))) {
          console.log('‚ö†Ô∏è Cuota de base de datos principal excedida');
          console.log('üîÑ Cambiando autom√°ticamente a base de datos de respaldo...');
          
          try {
            // Reinicializar con base de datos de respaldo
            firebaseInicializado = false;
            db = null;
            window.db = null;
            
            const exitoRespaldo = await inicializarFirebaseRespaldo();
            
            if (exitoRespaldo && db) {
              console.log('‚úÖ Cambiado a base de datos de respaldo');
              console.log('üîÑ Reintentando cargar productos...');
              
              // Reintentar cargar productos
              return await window.cargarProductosDesdeFirebase();
            } else {
              console.log('‚ö†Ô∏è No se pudo conectar a respaldo, usando productos locales');
              window.mostrarProductosRespaldo();
            }
          } catch (errorRespaldo) {
            console.error('‚ùå Error cambiando a respaldo:', errorRespaldo);
            window.mostrarProductosRespaldo();
          }
        } else {
          console.log('üîÑ Usando productos de respaldo...');
          window.mostrarProductosRespaldo();
        }
      }
    };

    window.mostrarProductos = function(productos) {
      const hamburguesasGrid = document.getElementById('hamburguesas-grid');
      const promosGrid = document.getElementById('promos-grid');
      const bebidasGrid = document.getElementById('bebidas-grid');
      const extraGrid = document.getElementById('extra-grid');
      hamburguesasGrid.innerHTML = '';
      promosGrid.innerHTML = '';
      bebidasGrid.innerHTML = '';
      if (extraGrid) extraGrid.innerHTML = '';

      productos.forEach(producto => {
        const div = document.createElement('div');
        div.className = 'product-card';

        const imagenReal = producto.imagen;
        const placeholderUrl = './fotos/bebidas/bebida.jpg'; // Fallback local

        div.innerHTML = `
          <div class="product-image">
            <img src="${imagenReal}" 
                 alt="${producto.nombre}" 
                 onerror="this.src='${placeholderUrl}'; this.onerror=null;"
                 style="background-color: #ffcb05; color: #000;">
          </div>
          <div class="product-info">
            <h3>${producto.nombre}</h3>
            <p class="product-description">${producto.descripcion || 'Deliciosa opci√≥n de nuestra carta'}</p>
            <div class="product-price">$${producto.precio.toLocaleString()}</div>
            <button class="btn-agregar" onclick="event.stopPropagation(); agregarAlCarrito('${producto.nombre}', ${producto.precio}, '${producto.categoria || ''}')">Agregar al Carrito</button>
          </div>
        `;

        if (producto.categoria === 'promo') {
          promosGrid.appendChild(div);
        } else if (producto.categoria === 'bebidas') {
          bebidasGrid.appendChild(div);
        } else if (producto.categoria === 'extra') {
          if (extraGrid) extraGrid.appendChild(div);
        } else {
          hamburguesasGrid.appendChild(div);
        }
      });
    }

    window.mostrarProductosRespaldo = function() {
      const productos = [
        // Hamburguesas
        { nombre: "Smash", precio: 10000, categoria: "hamburguesa", descripcion: "Medall√≥n simple, cheddar, nuestra salsa especial + papas fritas ", imagen: "./fotos/hamburguesas/smash.jpg" },
        { nombre: "Crypton", precio: 10000, categoria: "hamburguesa", descripcion: "simple medallon, cebolla caramelizada y queso roquefort + papas fritas", imagen: "./fotos/hamburguesas/cripton.jpg" },
        { nombre: "Wave", precio: 10000, categoria: "hamburguesa", descripcion: "simple medall√≥n, queso provolone y mayocriolla + papas fritas", imagen: "./fotos/hamburguesas/wave.jpg" },
        { nombre: "AX100", precio: 12500, categoria: "hamburguesa", descripcion: "Doble medall√≥n, doble cheddar crujientes y doble bacon + papas fritas", imagen: "./fotos/hamburguesas/ax100.jpg" },
        { nombre: "YBR", precio: 13500, categoria: "hamburguesa", descripcion: "doble medall√≥n, doble cheddar crujientes, cebolla caramelizada y salsa barbacoa + papas fritas", imagen: "./fotos/hamburguesas/ybr.jpg" },
        { nombre: "Tornado 293", precio: 13000, categoria: "hamburguesa", descripcion: "doble medall√≥n, doble cheddar, morron asado y salsa pro tork + papas fritas", imagen: "./fotos/hamburguesas/tornado293.jpg" },
        { nombre: "FAN", precio: 16500, categoria: "hamburguesa", descripcion: "triple medall√≥n, triple cheddar, triple bacon crujientes y salsa butaquera + papas fritas", imagen: "./fotos/hamburguesas/fan.jpg" },
        { nombre: "ax115", precio: 21000, categoria: "hamburguesa", descripcion: "5 medall√≥n, 5 cheddar, 5 bacon crujientes y salsa butaquera + papas fritas", imagen: "./fotos/hamburguesas/ax115.jpg" },
        // Promos
        { nombre: "Promo Smash", precio: 27000, categoria: "promo", descripcion: "Smash x3 + 3 papas fritas + 3 bebida. ¬°El combo perfecto para compartir!", imagen: "./fotos/promociones/promo-smash.jpg" },
        { nombre: "Promo Cripton", precio: 27000, categoria: "promo", descripcion: "crypton x3 + 3 papas fritas + 3 bebida. ¬°Sabor y cantidad en una sola promo!", imagen: "./fotos/promociones/promo-crypton.jpg" },
        { nombre: "Promo Wave", precio: 27000, categoria: "promo", descripcion: "Wave x3 + 3 papas fritas + 3 bebida. ¬°Un combo de puro sabor!", imagen: "./fotos/promociones/promo-wave.jpg" },
        { nombre: "Promo AX100", precio: 30000, categoria: "promo", descripcion: "AX100 x2 + 2 papas fritas + 2 bebida de elecci√≥n. ¬°Doble medall√≥n, doble placer!", imagen: "./fotos/promociones/promo-ax100.jpeg" },
        { nombre: "Promo Variant", precio: 36000, categoria: "promo", descripcion: "Variant x3 + 3 papas fritas + 3 bebida de elecci√≥n. ¬°Sabor √∫nico e irresistible!", imagen: "./fotos/promociones/promo variant.jpeg" },
        // Nuevas promos
        { nombre: "promo ybr", precio: 33000, categoria: "promo", descripcion: "2 ybr + combo de papas fritas con cheddar y bacon + 2 bebidas", imagen: "./fotos/promociones/promo ybr.jpeg" },
        { nombre: "promo fan", precio: 38000, categoria: "promo", descripcion: "2 fan + combo de papas fritas con cheddar y bacon + 2 bebidas", imagen: "./fotos/promociones/promo-fan.jpg" },
        // Bebidas
        { nombre: "Pepsi", precio: 2500, categoria: "bebidas", descripcion: "Gaseosa fr√≠a de 500ml. Pepsi", imagen: "./fotos/bebidas/pepsi.jpg" },
        { nombre: "Seven Up", precio: 2500, categoria: "bebidas", descripcion: "Gaseosa fr√≠a de 500ml. Seven Up", imagen: "./fotos/bebidas/seven-up.jpg" },
        // Extras
        { nombre: "Aros de cebolla", precio: 5000, categoria: "extra", descripcion: "Aros de cebolla + papas fritas + alioli", imagen: "./fotos/extras/aros-de-cebolla-caseros-crujientes.jpg" },
        { nombre: "Bastones de mozzarella", precio: 7500, categoria: "extra", descripcion: "Bastones de mozzarella + papas fritas + alioli", imagen: "./fotos/extras/bastones-de-mozzarella.jpg" },
        { nombre: "Flan", precio: 5000, categoria: "extra", descripcion: "Flan casero", imagen: "./fotos/extras/flan.jpg" }
      ];
      window.mostrarProductos(productos);
    }
  </script>
  
  <script src="script.js"></script>
  
  <script>
    // Ejecutar inmediatamente despu√©s de cargar todo
    if (window.mostrarProductosRespaldo) {
      window.mostrarProductosRespaldo();
    } else {
      setTimeout(() => {
        if (window.mostrarProductosRespaldo) {
          window.mostrarProductosRespaldo();
        }
      }, 100);
    }
  </script>
</body>
</html>